#!/bin/sh

#
# This script will filter out the anomalous and suspicious packet from all splited output_*.pcap files (after splitPcap.sh)
# and output as output_*filtered.pcap
#
# Filter rule is obtained from mawilabExtract.py
#
# tshark -r input_file.pcap -w output_file.pcap -Y filter_rule
#

for i in output_*.pcap; do
	tshark -r ${i%.*}.pcap -w ${i%.*}filtered.pcap -Y "tcp && not ( (ip.src == 203.180.193.203 && ip.dst == 206.108.229.126) ||  (ip.src == 203.180.193.203 && ip.dst == 204.206.44.225) ||  (ip.src == 81.57.79.223 && ip.dst == 133.139.193.192 && tcp.dstport == 6534) ||  (ip.src == 13.114.169.63 && tcp.dstport == 1433) ||  (ip.src == 122.219.69.149 && tcp.dstport == 1433) ||  (ip.src == 37.201.152.38 && tcp.srcport == 14676 && tcp.dstport == 5060) ||  (ip.src == 163.221.27.217 && tcp.dstport == 1433) ||  (ip.src == 188.163.188.135 && tcp.dstport == 1900) ||  (ip.src == 113.211.191.117 && tcp.dstport == 80) ||  (ip.src == 113.211.191.117 && tcp.dstport == 443) ||  (ip.src == 61.77.113.50 && tcp.dstport == 65529) ||  (ip.src == 115.216.135.90 && tcp.dstport == 445) ||  (ip.src == 115.216.135.90 && tcp.dstport == 1433) ||  (ip.src == 192.95.169.188 && tcp.srcport == 5062 && tcp.dstport == 5160) ||  (ip.src == 37.201.154.231 && tcp.srcport == 43966 && tcp.dstport == 5960) ||  (ip.src == 165.12.106.190 && tcp.srcport == 50457 && tcp.dstport == 5683) ||  (ip.src == 101.30.245.228 && tcp.dstport == 800) ||  (ip.src == 203.180.212.8 && tcp.dstport == 1433) ||  (ip.src == 185.13.60.58 && tcp.dstport == 1900) ||  (ip.src == 93.115.212.14 && tcp.dstport == 1433) ||  (ip.src == 116.232.226.81 && tcp.dstport == 445) ||  (ip.src == 42.68.46.91 && tcp.dstport == 1433) ||  (ip.src == 193.169.246.95 && tcp.dstport == 1900) ||  (ip.src == 218.69.27.153 && tcp.dstport == 1433) ||  (ip.src == 222.153.242.243 && tcp.dstport == 1433) ||  (ip.src == 113.150.178.231 && tcp.dstport == 1433) ||  (ip.src == 112.229.21.5 && tcp.dstport == 445) ||  (ip.src == 59.210.229.109 && tcp.dstport == 1433) ||  (ip.src == 59.210.229.109 && tcp.dstport == 445) ||  (ip.src == 188.163.187.102 && tcp.dstport == 1900) ||  (ip.src == 188.15.127.142) ||  (tcp.srcport == 443 && ip.dst == 202.249.81.221) ||  (ip.src == 89.8.230.8 && tcp.dstport == 2222) ||  (ip.src == 80.99.178.138 && tcp.dstport == 445) ||  (ip.src == 203.180.205.57 && ip.dst == 202.151.124.46) ||  (ip.src == 203.180.205.57 && tcp.srcport == 3001) ||  (tcp.srcport == 3001 && ip.dst == 202.151.124.46) ||  (ip.src == 54.143.244.166 && ip.dst == 203.180.196.192 && tcp.dstport == 80) ||  (ip.dst == 203.180.203.175 && tcp.dstport == 80) ||  (ip.src == 203.180.200.85 && ip.dst == 185.118.253.238 && tcp.dstport == 53) ||  (ip.src == 203.180.200.85 && ip.dst == 194.97.62.232 && tcp.dstport == 53) ||  (tcp.srcport == 443 && ip.dst == 202.11.243.166) ||  (ip.src == 8.8.4.52 && tcp.srcport == 53 && ip.dst == 202.11.243.166) ||  (tcp.srcport == 443 && ip.dst == 163.221.26.182) ||  (ip.dst == 203.180.193.46 && tcp.dstport == 80) ||  (tcp.srcport == 53 && ip.dst == 203.180.198.144) ||  (tcp.srcport == 443 && ip.dst == 203.180.198.144) ||  (ip.src == 151.93.137.50 && ip.dst == 163.221.149.60) ||  (ip.src == 151.93.137.50 && ip.dst == 163.221.156.208) ||  (ip.src == 151.93.137.50 && tcp.srcport == 80) ||  (ip.src == 151.93.6.162 && ip.dst == 163.221.149.60) ||  (ip.src == 151.93.6.162 && ip.dst == 163.221.156.208) ||  (ip.src == 151.93.6.162 && tcp.srcport == 80) ||  (tcp.srcport == 80 && ip.dst == 163.221.149.60) ||  (tcp.srcport == 443 && ip.dst == 163.221.149.60) ||  (tcp.srcport == 80 && ip.dst == 163.221.156.208) ||  (ip.dst == 203.180.205.18 && tcp.dstport == 3010) ||  (tcp.srcport == 443 && ip.dst == 202.11.241.113) ||  (tcp.srcport == 443 && ip.dst == 203.180.207.105) ||  (ip.src == 1.6.204.33 && tcp.srcport == 53 && ip.dst == 203.180.207.105) ||  (tcp.srcport == 80) ||  (tcp.srcport == 443 && ip.dst == 163.221.61.122) ||  (ip.src == 203.180.192.43 && tcp.srcport == 53) ||  (ip.src == 203.180.193.46 && tcp.srcport == 80) ||  (ip.src == 202.151.124.46 && ip.dst == 203.180.205.57) ||  (ip.src == 202.151.124.46 && tcp.dstport == 3001) ||  (ip.dst == 203.180.205.57 && tcp.dstport == 3001) ||  (ip.src == 202.11.241.113 && tcp.dstport == 443) ||  (ip.src == 202.249.81.221 && tcp.dstport == 443) ||  (tcp.srcport == 443 && ip.dst == 163.221.156.216) ||  (ip.src == 117.21.108.143 && tcp.srcport == 80) ||  (tcp.srcport == 443 && ip.dst == 163.221.145.111) ||  (ip.src == 146.136.243.204) ||  (ip.src == 89.8.232.251 && tcp.srcport == 53036) ||  (tcp.srcport == 443 && ip.dst == 202.11.243.111) ||  (tcp.srcport == 443 && ip.dst == 202.11.241.90) ||  (tcp.srcport == 443 && ip.dst == 163.221.123.50) ||  (ip.src == 104.240.207.62 && tcp.srcport == 443 && ip.dst == 163.221.77.180) ||  (tcp.srcport == 443 && ip.dst == 202.11.241.145) ||  (ip.dst == 94.157.230.215 && tcp.dstport == 57836) ||  (tcp.srcport == 22 && ip.dst == 218.64.0.179) ||  (ip.src == 203.180.198.144 && ip.dst == 119.195.3.101 && tcp.dstport == 443) ||  (ip.src == 203.180.212.8 && ip.dst == 119.195.3.101 && tcp.dstport == 443) ||  (ip.src == 133.40.183.220 && ip.dst == 119.195.3.101 && tcp.dstport == 443) ||  (ip.src == 151.93.230.198 && tcp.srcport == 443 && ip.dst == 163.221.127.15 && tcp.dstport == 59334) ||  (ip.src == 151.93.230.198 && tcp.srcport == 443 && ip.dst == 163.221.127.15 && tcp.dstport == 59261) ||  (ip.src == 151.93.230.198 && tcp.srcport == 443 && ip.dst == 163.221.159.125 && tcp.dstport == 39360) ||  (tcp.srcport == 443 && ip.dst == 163.221.156.226) ||  (tcp.srcport == 443 && ip.dst == 202.11.241.212) ||  (tcp.srcport == 443 && ip.dst == 163.221.127.65) ||  (ip.dst == 163.221.127.65) ||  (tcp.srcport == 443 && ip.dst == 133.139.204.215) ||  (ip.dst == 133.139.204.215) ||  (ip.src == 194.85.189.229 && tcp.srcport == 113 && ip.dst == 203.180.212.8) ||  (ip.src == 194.85.189.229 && ip.dst == 203.180.212.8 && tcp.dstport == 25) ||  (ip.src == 194.85.189.229 && ip.dst == 133.139.196.52 && tcp.dstport == 25) ||  (tcp.srcport == 443 && ip.dst == 163.221.127.88) ||  (tcp.srcport == 443 && ip.dst == 163.221.127.51) ||  (tcp.srcport == 443 && ip.dst == 133.139.123.207) ||  (tcp.srcport == 443 && ip.dst == 163.221.12.191) ||  (tcp.srcport == 443 && ip.dst == 202.6.22.20) ||  (tcp.srcport == 443 && ip.dst == 202.11.244.151) ||  (tcp.srcport == 53 && ip.dst == 203.180.203.185) ||  (ip.src == 186.237.162.17 && tcp.srcport == 443 && ip.dst == 163.221.53.125 && tcp.dstport == 62926) ||  (ip.src == 88.162.108.220 && tcp.srcport == 443 && ip.dst == 23.0.14.204 && tcp.dstport == 54468) ||  (ip.src == 163.221.157.41 && tcp.srcport == 8078 && ip.dst == 27.123.247.8 && tcp.dstport == 11130) ||  (ip.src == 114.35.227.14 && tcp.srcport == 443 && ip.dst == 163.221.39.220 && tcp.dstport == 52480) ||  (ip.src == 202.11.241.145 && tcp.dstport == 80) ||  (ip.src == 99.80.191.143 && tcp.srcport == 443 && ip.dst == 202.11.241.90 && tcp.dstport == 57339) ||  (ip.src == 163.221.157.215 && tcp.srcport == 49970 && ip.dst == 133.139.47.245 && tcp.dstport == 993) ||  (ip.src == 126.27.111.134 && tcp.srcport == 42901 && ip.dst == 203.180.205.36 && tcp.dstport == 40739) ||  (ip.src == 40.157.11.164 && tcp.srcport == 993 && ip.dst == 203.180.207.97 && tcp.dstport == 63165) ||  (ip.src == 163.221.156.200 && ip.dst == 66.110.250.68 && tcp.dstport == 443) ||  (ip.src == 163.221.53.35 && tcp.srcport == 53406 && ip.dst == 52.82.235.241 && tcp.dstport == 443) ||  (ip.src == 52.217.158.251 && tcp.srcport == 42704 && ip.dst == 203.180.193.46 && tcp.dstport == 80) ||  (ip.src == 112.90.126.131 && ip.dst == 203.180.198.180 && tcp.dstport == 80) ||  (ip.src == 192.125.88.46 && tcp.dstport == 23) ||  (ip.src == 185.105.198.169) ||  (ip.src == 185.38.3.188) ||  (ip.src == 27.238.209.51 && tcp.dstport == 1433) ||  (ip.dst == 185.105.198.169) ||  (ip.src == 123.160.60.2 && tcp.srcport == 80 && ip.dst == 163.221.159.122 && tcp.dstport == 61188) ||  (ip.src == 70.218.172.253 && ip.dst == 203.180.201.21 && tcp.dstport == 53) ||  (ip.src == 64.223.195.124 && ip.dst == 203.180.201.21 && tcp.dstport == 53) ||  (ip.src == 89.8.228.69 && tcp.srcport == 53056) ||  (ip.src == 101.167.51.160 && tcp.dstport == 1433) ||  (ip.src == 59.83.26.125 && tcp.dstport == 1433) ||  (ip.src == 180.88.25.21 && tcp.dstport == 445) ||  (ip.src == 222.171.238.113 && tcp.dstport == 1433) ||  (ip.src == 218.64.0.179 && tcp.dstport == 22) ||  (ip.dst == 217.206.251.55) ||  (ip.src == 101.167.51.160 && tcp.dstport == 445) ||  (ip.src == 0.0.0.0) ||  (ip.dst == 0.0.0.0) ||  (ip.src == 218.173.2.139 && tcp.srcport == 52506 && tcp.dstport == 23) ||  (ip.src == 87.161.167.215 && tcp.srcport == 49153 && tcp.dstport == 23) ||  (ip.src == 99.80.191.145 && tcp.srcport == 443 && ip.dst == 202.11.241.90 && tcp.dstport == 54029) ||  (ip.src == 3.232.197.167) ||  (ip.src == 78.172.26.67 && tcp.srcport == 40490 && tcp.dstport == 23) ||  (ip.src == 78.172.26.67 && tcp.srcport == 40490 && tcp.dstport == 9000) ||  (ip.src == 49.125.243.92 && tcp.dstport == 23) ||  (ip.src == 41.108.26.53 && tcp.dstport == 445) ||  (ip.src == 41.108.26.53 && tcp.dstport == 1433) ||  (ip.src == 110.225.204.67 && tcp.dstport == 8080) ||  (ip.src == 218.173.232.76 && tcp.srcport == 54589 && tcp.dstport == 23) ||  (ip.src == 13.115.12.107 && tcp.srcport == 443 && ip.dst == 203.180.207.97) ||  (ip.src == 13.115.12.107 && tcp.srcport == 443 && ip.dst == 163.221.180.158) ||  (ip.src == 13.115.12.107 && tcp.srcport == 443 && ip.dst == 163.221.126.9) ||  (ip.src == 0.0.0.0) ||  (ip.dst == 0.0.0.0) ||  (ip.dst == 203.180.200.85 && tcp.dstport == 123) ||  (ip.src == 185.118.253.238 && tcp.srcport == 53 && ip.dst == 203.180.200.85) ||  (tcp.srcport == 443 && ip.dst == 207.58.226.67) ||  (ip.src == 23.0.14.204 && tcp.srcport == 53 && ip.dst == 207.58.226.67) ||  (ip.src == 14.0.47.95 && tcp.srcport == 443 && ip.dst == 163.221.126.42) ||  (ip.dst == 163.221.173.242 && tcp.dstport == 53) ||  (tcp.srcport == 443 && ip.dst == 163.221.168.13) ||  (tcp.srcport == 443 && ip.dst == 163.221.169.208) ||  (tcp.srcport == 443 && ip.dst == 163.221.163.232) ||  (ip.dst == 54.165.204.68) ||  (ip.dst == 52.58.126.0) ||  (ip.dst == 13.55.232.102) ||  (ip.dst == 13.55.229.223) ||  (ip.dst == 35.62.139.225) ||  (ip.dst == 202.6.26.41 && tcp.dstport == 53) ||  (ip.src == 80.234.2.203 && ip.dst == 133.24.153.231 && tcp.dstport == 80) ||  (ip.dst == 203.180.192.43 && tcp.dstport == 53) ||  (tcp.srcport == 1939 && ip.dst == 45.82.226.20 && tcp.dstport == 47787) ||  (ip.src == 126.233.155.213 && ip.dst == 202.11.241.220 && tcp.dstport == 443) ||  (ip.src == 89.74.163.182 && ip.dst == 202.11.241.220 && tcp.dstport == 443) ||  (tcp.srcport == 443 && ip.dst == 203.180.200.17) ||  (ip.dst == 202.11.241.113 && tcp.dstport == 54756) ||  (ip.dst == 133.24.158.13 && tcp.dstport == 50348) ||  (tcp.srcport == 80 && ip.dst == 163.221.10.4) ||  (tcp.srcport == 443 && ip.dst == 163.221.10.4) ||  (ip.dst == 133.139.237.197 && tcp.dstport == 8080) ||  (ip.dst == 133.139.237.197 && tcp.dstport == 8000) ||  (ip.dst == 133.139.237.197 && tcp.dstport == 16285) ||  (ip.dst == 203.180.192.57 && tcp.dstport == 53) ||  (tcp.srcport == 53 && ip.dst == 202.6.46.3) ||  (ip.dst == 203.180.192.63 && tcp.dstport == 53) ||  (tcp.srcport == 80 && ip.dst == 147.4.132.82) ||  (ip.src == 221.158.184.99 && ip.dst == 202.11.241.178) ||  (ip.src == 221.158.184.99 && tcp.srcport == 53) ||  (tcp.srcport == 53 && ip.dst == 202.11.241.178) ||  (tcp.srcport == 443 && ip.dst == 163.221.26.169) ||  (ip.src == 80.234.2.203 && ip.dst == 133.24.130.72 && tcp.dstport == 80) ||  (ip.dst == 203.180.203.164 && tcp.dstport == 443) ||  (ip.src == 192.77.203.223 && ip.dst == 203.180.203.164 && tcp.dstport == 1194) ||  (tcp.srcport == 53 && ip.dst == 150.199.126.78) ||  (tcp.srcport == 53 && ip.dst == 163.221.240.94) ||  (tcp.srcport == 53 && ip.dst == 163.221.241.160) ||  (tcp.srcport == 53 && ip.dst == 163.221.240.95) ||  (tcp.srcport == 53 && ip.dst == 202.11.241.154) ||  (ip.dst == 150.199.64.109 && tcp.dstport == 54748) ||  (tcp.srcport == 53 && ip.dst == 202.11.241.152) ||  (ip.dst == 150.199.64.117 && tcp.dstport == 54756) ||  (ip.src == 192.77.203.223 && ip.dst == 203.180.203.130 && tcp.dstport == 1194) ||  (ip.dst == 89.8.225.58) ||  (ip.src == 157.114.168.214 && tcp.srcport == 32766 && ip.dst == 163.221.220.233) ||  (ip.dst == 133.139.59.231 && tcp.dstport == 50348) ||  (ip.dst == 133.24.156.205 && tcp.dstport == 50356) ||  (ip.dst == 203.180.207.72 && tcp.dstport == 53) ||  (ip.src == 192.77.203.223 && ip.dst == 203.180.207.66 && tcp.dstport == 1194) ||  (ip.src == 80.234.2.203 && ip.dst == 133.24.133.94 && tcp.dstport == 80) ||  (ip.src == 133.24.158.78 && tcp.srcport == 23 && ip.dst == 192.125.88.46) ||  (ip.src == 133.24.158.79 && tcp.srcport == 23 && ip.dst == 192.125.88.46) ||  (ip.src == 133.24.158.81 && tcp.srcport == 23 && ip.dst == 192.125.88.46) ||  (ip.src == 133.24.158.80 && tcp.srcport == 23 && ip.dst == 192.125.88.46) ||  (ip.dst == 163.221.165.37) ||  (ip.src == 192.77.203.223 && ip.dst == 203.180.207.94 && tcp.dstport == 1194) ||  (ip.src == 154.48.234.21 && ip.dst == 203.180.207.106) ||  (ip.src == 154.48.234.21 && tcp.srcport == 6080) ||  (tcp.srcport == 443 && ip.dst == 203.180.207.106) ||  (tcp.srcport == 6080 && ip.dst == 203.180.207.106) ||  (ip.src == 1.6.204.33 && tcp.srcport == 53 && ip.dst == 203.180.207.106) ||  (tcp.srcport == 443 && ip.dst == 163.221.77.146) ||  (tcp.srcport == 22 && ip.dst == 222.180.196.111) ||  (ip.dst == 150.199.65.114 && tcp.dstport == 54756) ||  (ip.dst == 163.221.240.102) ||  (ip.dst == 150.199.50.229 && tcp.dstport == 54748) ||  (ip.src == 203.180.207.106 && tcp.dstport == 443) ||  (ip.dst == 102.94.70.4 && tcp.dstport == 443) ||  (tcp.srcport == 443 && ip.dst == 163.221.126.240) ||  (tcp.srcport == 443 && ip.dst == 202.11.241.195) ||  (ip.src == 203.180.207.66 && tcp.srcport == 1194 && ip.dst == 192.77.203.223) ||  (ip.src == 203.180.203.130 && tcp.srcport == 1194 && ip.dst == 192.77.203.223) ||  (ip.src == 203.180.207.94 && tcp.srcport == 1194 && ip.dst == 192.77.203.223) ||  (ip.src == 203.180.203.164 && tcp.srcport == 1194 && ip.dst == 192.77.203.223) ||  (ip.src == 151.93.138.222 && tcp.srcport == 443 && ip.dst == 13.35.206.114 && tcp.dstport == 59286) ||  (ip.src == 151.93.138.222 && tcp.srcport == 443 && ip.dst == 13.35.206.114 && tcp.dstport == 59202) ||  (ip.src == 151.93.138.222 && tcp.srcport == 443 && ip.dst == 13.35.206.114 && tcp.dstport == 59201) ||  (ip.src == 151.93.138.222 && tcp.srcport == 443 && ip.dst == 163.221.127.141 && tcp.dstport == 61275) ||  (ip.src == 88.190.30.103 && tcp.srcport == 50417) ||  (ip.src == 202.11.246.110 && tcp.srcport == 443 && ip.dst == 126.152.247.217 && tcp.dstport == 56305) ||  (tcp.srcport == 443 && ip.dst == 163.221.158.108) ||  (tcp.srcport == 443 && ip.dst == 163.221.127.89) ||  (tcp.srcport == 443 && ip.dst == 163.221.126.219) ||  (ip.src == 104.138.142.201 && tcp.srcport == 443 && ip.dst == 163.221.126.72) ||  (tcp.srcport == 443 && ip.dst == 203.180.132.83) ||  (ip.dst == 203.180.132.83) ||  (ip.dst == 163.221.24.224) ||  (tcp.srcport == 80 && ip.dst == 203.180.200.15) ||  (tcp.srcport == 443 && ip.dst == 203.180.200.15) ||  (ip.dst == 163.221.16.136 && tcp.dstport == 8883) )"
done


